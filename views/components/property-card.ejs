<%
  const p = property;
  const firstImage = (p.imageUrls && p.imageUrls.length) ? p.imageUrls[0] : null;
  const priceText = typeof p.price === 'number'
    ? p.price.toLocaleString('en-IN')
    : (p.price || '');
  const suitable = (p.suitableFor || []).join(', ');

  const rawTitle = p.title || String(p._id || '');
  const slugTitle = rawTitle
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-|-$/g, '');
  const slug = `${slugTitle}-${p._id}`;
%>

<a href="/property/<%= slug %>" class="block h-full">
  <div class="flex flex-col h-full">
    <!-- Image -->
    <div class="relative w-full h-48 overflow-hidden rounded-t-lg bg-gray-100">
      <% if (firstImage) { %>
        <img src="<%= firstImage %>"
             alt="<%= p.title %>"
             loading="lazy"
             class="w-full h-full object-cover" />
      <% } else { %>
        <div class="w-full h-full flex items-center justify-center text-gray-400 text-sm">
          No image
        </div>
      <% } %>

      <div class="absolute top-2 left-2 bg-white/90 text-xs font-semibold px-2 py-1 rounded-full text-gray-800 shadow">
        â‚¹ <%= priceText %>
      </div>

      <% if (p.city) { %>
        <div class="absolute bottom-2 left-2 bg-black/60 text-[11px] text-white px-2 py-1 rounded-full">
          <%= p.city %>, <%= p.state || 'Uttarakhand' %>
        </div>
      <% } %>
    </div>

    <!-- Content -->
    <div class="flex-1 p-4 flex flex-col">
      <h3 class="font-semibold text-gray-900 text-base mb-1 line-clamp-2">
        <%= p.title %>
      </h3>
      <p class="text-xs text-gray-500 mb-2 line-clamp-1">
        <%= p.location %>
      </p>

      <% if (suitable) { %>
        <p class="text-xs text-gray-600 mb-3 line-clamp-1">
          Suitable for: <span class="font-medium"><%= suitable %></span>
        </p>
      <% } %>

      <div class="mt-auto flex items-center justify-between text-xs text-gray-500">
        <span>Added: <%= new Date(p.createdAt).toLocaleDateString('en-IN') %></span>
        <span class="inline-flex items-center gap-1 text-blue-600">
          View details
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none"
               viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 5l7 7-7 7" />
          </svg>
        </span>
      </div>
    </div>
  </div>
</a>
  